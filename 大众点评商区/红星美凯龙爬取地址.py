#!/usr/bin/env python# -*- coding: utf-8 -*-# Created by spider3 on 2018/6/14# Copyright (c) 2018 spider3. All rights reserved.import requests_htmlimport jsonse = requests_html.HTMLSession()def get_all_city_url():    url = "https://jz.mmall.com/city.html"    response = se.get(url)    hrefs = response.html.xpath("/html/body/div[3]/div[2]/a/@href")    city_name = response.html.xpath("/html/body/div[3]/div[2]/a/div/div[1]/text()")    print(len(hrefs), len(city_name))    return zip(hrefs, city_name)def get_detail_address_url(city_url):    response = se.get(city_url)    url = response.html.xpath("/html/body/div[1]/div[2]/div[3]/div/div[2]/div[4]/div/a/@href")    print(url)    return urldef get_detail_address(detail_url):    response = se.get(detail_url)    name = response.html.xpath('//p[@class="bannerTil"]/text()')[0]    address = response.html.xpath('//div[@class="bannerAddress"]/span/text()')[0]    print(name, address)    return name, addressdef start():    li = []    for city_url in get_all_city_url():  # (hrefs, city_name)        for address_url in get_detail_address_url(city_url[0]):            name, address = get_detail_address(address_url)            tmp = {}            tmp["name"] = name            tmp["address"] = address            tmp["city"] = city_url[1]            li.append(tmp)    with open("./红星美凯龙数据.json", "w") as f:        try:            f.write(json.dumps(li, ensure_ascii=False))        except:            f.write(json.dumps(li))def main():    # for i in get_all_address_url():    #     print(i)    # get_detail_address_url("https://shanghai.mmall.com/")    # get_detail_address('https://shanghai.mmall.com/market/19324.html')    start()if __name__ == '__main__':    main()
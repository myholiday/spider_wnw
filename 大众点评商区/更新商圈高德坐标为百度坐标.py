#!/usr/bin/env python# -*- coding: utf-8 -*-# Created by spider3 on 2018/6/13# Copyright (c) 2018 spider3. All rights reserved.import pymysqlimport requestsimport jsonimport timefrom retry import retrydef get_all_data():    connection = pymysql.connect(host='localhost',                                 user='root',                                 password='root',                                 db='qianxungou',                                 port=3306,                                 charset='utf8')    sql = "select `id`,`lng`,`lat`,`merger_name` from feigo_regions WHERE `level_type`=4 AND `zip_code` is NULL ; "    with connection.cursor() as cursor:        cursor.execute(sql)        data = cursor.fetchall()    # print(data)    print(len(data))    return data@retry(10)def change_coord_amap2baidu(coord):    """    :param coord:  108.123134,30.54681    :return:    """    url = "http://api.map.baidu.com/geoconv/v1/?from=3&to=5&ak=mDml72vqmPtHmZHl7tus153lx9e1pg8A&coords=" + coord    headers = {'Host': 'api.map.baidu.com',               'Upgrade-Insecure-Requests': '1',               'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36'}    response = requests.get(url, headers=headers)    dict_response = json.loads(response.text)    if dict_response["status"] != 0:        return    x, y = dict_response["result"][0]["x"], dict_response["result"][0]["y"]    return x, ydef save_sql():    data = get_all_data()    for one_data in data:        # print(one_data)        baidu_x, baidu_y = change_coord_amap2baidu(str(one_data[1])+","+str(one_data[2]))        sql = "UPDATE `feigo_regions` SET `zip_code`='baidu',`lng`={},`lat`={} WHERE `id`={};  # {} \n".format(baidu_x, baidu_y, one_data[0], one_data[3])        print(sql)        write_sql(sql)        time.sleep(0.5)def write_sql(sql):    with open("./amap2baidu_coord.sql", "a", encoding="utf-8") as f:        f.write(sql)def main():    # data = get_all_data()    # print(len(data))    # change_coord_amap2baidu("114.888826,31.64282")    save_sql()if __name__ == '__main__':    main()
#!/usr/bin/env python# -*- coding: utf-8 -*-# Created by spider3 on 2018/5/8# Copyright (c) 2018 spider3. All rights reserved.# 雅之杰# http://www.atgetco.com/show_list.php?id=42#import requests_htmlimport reimport jsonsession = requests_html.HTMLSession()def get_ids():    url = "http://www.atgetco.com/show_list.php?id=42"    response = session.get(url)    ids = response.html.xpath("/html/body/div[4]/div[2]/div/div[1]/div[1]/div[1]/div[1]/div[2]/p/@onclick")    ids = [id.split("(")[-1].split(")")[0] for id in ids]    return idsdef get_name_and_addr(id):    base_url = "http://www.atgetco.com/getcity.php?id={}&ty=3"    url = base_url.format(id)    response = session.get(url)    name = response.html.xpath("//li/h3/text()", )    address = response.html.xpath("//li/p[2]/text()", )    # print(name,address)    response.html.search    return (name, address)def get_jwcoord(id):    base_url = "http://www.atgetco.com/getcity.php?id={}&ty=11"    url = base_url.format(id)    response = session.get(url)    html_text = response.text.replace("new BMap.Point();", "")    jw = re.findall(r"var point\d+ = new BMap.Point\((.*?)\);", html_text)    # print(jw)    return jwdef spider():    ids = get_ids()    print(ids)    li = []    for id in ids:        name, address = get_name_and_addr(id)        jw_coord = get_jwcoord(id)        for i in range(len(jw_coord)):            tmp = {}            tmp['name'] = name[i]            tmp['address'] = address[i]            tmp['longitude'], tmp['latitude'] = jw_coord[i].split(",")            li.append(tmp)            print(tmp)    with open("../data/atgetco.json", "w") as f:        f.write(json.dumps(li, ensure_ascii=False))def main():    # get_id()    # get_name_and_addr(6)    # get_jwcoord(6)    spider()if __name__ == '__main__':    main()
#!/usr/bin/env python# -*- coding: utf-8 -*-# Created by spider3 on 2018/3/30# Copyright (c) 2018 spider3. All rights reserved."""晨阳水漆""""""http://www.chenyang.com/index.php"""import requestsimport jsonfrom lxml import etreedef get_provinces():    url = 'http://www.chenyang.com/index.php?m=content&c=index&a=lists&catid=27&page=3&p=%E5%B9%BF%E4%B8%9C#page_content'    response = requests.get(url)    html = etree.HTML(response.text)    provinces = html.xpath('//select[@id="province"]/option/text()')[1:]    print(provinces)    return provincesdef get_detail(province, page):    li = []    url = 'http://www.chenyang.com/index.php?m=content&c=index&a=lists&catid=27&page={}&p={}'.format(page, province)    headers = {        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36',        'Cookie': 'LXB_REFER=www.baidu.com; UM_distinctid=16275d1264de3-04dcbad0afcbc6-b34356b-1fa400-16275d1264e41e; CNZZDATA1253389134=233161325-1522390830-http%253A%252F%252Fwww.chenyang.com%252F%7C1522390830; Hm_lvt_0fae6adc11e434467603c88f6a52a2c3=1522395050,1522395155; isLoadPage=loaded; Hm_lpvt_0fae6adc11e434467603c88f6a52a2c3=1522396375'}    response = requests.get(url, headers=headers)    html = etree.HTML(response.text)    try:        nodes = html.xpath('//li[@class="row zmd-item"]')    except:        return li    for node in nodes:        tmp = {}        tmp['name'] = node.xpath('./div[1]/p/strong/text()')[0]        tmp['address'] = node.xpath('./div[2]/p/text()')[0]        print(tmp)        li.append(tmp)    return lidef spider():    li = []    provinces = get_provinces()    for province in provinces:        for page in range(1, 5):            li += get_detail(province, page)    try:        with open('../data/chenyang.json', 'w') as f:            f.write(json.dumps(li, ensure_ascii=False))    except:        with open('../data/chenyang.json', 'w') as f:            f.write(json.dumps(li, ensure_ascii=True))def main():    spider()if __name__ == '__main__':    main()
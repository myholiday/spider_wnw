#!/usr/bin/env python# -*- coding: utf-8 -*-# Created by spider3 on 2018/3/15# Copyright (c) 2018 spider3. All rights reserved.import jsonimport requestsimport refrom utils.get_baidu_coord import BaiduCoordfrom utils.get_address_by_ten_coord import get_address_by_ten_coordfrom utils.get_region_id import get_region_iddef get_data():    url = 'http://www.midea.com/cn/shipflagshop/shipflagshop.xml'    response = requests.get(url)    html = response.content.decode("utf-8")    # 匹配出中间字段    data = re.findall("<root>(.*?)</root>", html, re.S)[0]    # 去除两边空格及回车    data = data.strip()    data = data.replace('<REC ', '{')    data = data.replace(r'></REC>', '},')    data = data.replace('=', ':')    data = data.replace('" ', '",')    # 所有字段加上“”    data = data.replace('id', '"_id"')    data = data.replace('province', '"province"')  # 省    data = data.replace('city', '"city"')  # 市    data = data.replace('county', '"county"')  # 区    data = data.replace('name', '"name"')  # 名字    data = data.replace('link', '"link"')  # 详情地址    data = data.replace('address', '"address"')  # 详细地址    data = data.replace('director', '"director"')  # 负责人    data = data.replace('phone', '"phone_number"')  # 电话    data = data.replace('zoom', '"zoom"')    data = data.replace('lng', '"longitude"')  # 经度    data = data.replace('lat', '"latitude"')  # 纬度    data = eval(data)    return datadef add_detail(data):    data = list(data)    id = 108464    for one_data in data:        # 如果没有经纬度        one_data['id'] = id        id += 1        if not isinstance(one_data['longitude'],float):            bc = BaiduCoord(one_data['address'])            bc.get_ten_coord()            jw_coord = bc.get_jw_coord()            one_data['longitude'] = jw_coord['x']            one_data['latitude'] = jw_coord['y']        else:            one_data['official_coord'] = 1        if not one_data['county']:            bc = BaiduCoord(one_data['address'])            ten_coord = bc.get_ten_coord()            district = get_address_by_ten_coord(ten_coord["x"], ten_coord['y'])            district = district['address_detail']['district']            regionid1, regionid2, regionid3 = get_region_id(district)        else:            regionid1, regionid2, regionid3 = get_region_id(one_data['county'])        one_data['region_id_1'] = regionid1        one_data['region_id_2'] = regionid2        one_data['region_id_3'] = regionid3        one_data['create_time'] = 'NOW()'        one_data['preview_image'] = 'brands_images/full/2634.jpg'        one_data['brand_id'] = 2634        print(one_data)    with open("../data/meidi.json", 'w') as f:        f.write(json.dumps(data, ensure_ascii=False))def main():    data = get_data()    add_detail(data)if __name__ == '__main__':    main()
#!/usr/bin/env python# -*- coding: utf-8 -*-# Created by spider3 on 2018/3/19# Copyright (c) 2018 spider3. All rights reserved."""富安娜"""import json"""http://maps.fuanna.com/index.aspx"""import requestsfrom lxml import etreedef get_regions_id():    url = 'http://maps.fuanna.com/index.aspx'    response = requests.get(url)    html = etree.HTML(response.text)    regions_id = html.xpath('//select[@id="sheng"]/option/@value')    return regions_id[1:]def get_citys_id(region_id):    url = 'http://maps.fuanna.com/js/GetCity.ashx'    data = {'type': 'sheng', 'id': region_id}    response = requests.get(url, data)    city_str = response.text.split('|')    if city_str[0]:        print('city_str',city_str)        citys_id = [(i.split(',')[0], i.split(',')[1]) for i in city_str]        # print('citys_id',citys_id)        return citys_id    return []def get_district(city_id):    url = 'http://maps.fuanna.com/js/GetCity.ashx'    data = {'type': 'shi', 'id': city_id}    response = requests.get(url, data)    district_str = response.text.split('|')    if district_str[0]:        print(district_str)        districts_id = [(i.split(',')[0], i.split(',')[1]) for i in district_str]        return districts_id    return []li = []def get_detail(city, district_id, page):    global li    url = 'http://maps.fuanna.com/js/Index.aspx/'    pageindex = page    data = {'type': city, 'area': district_id[0], 'Brand': '0_a', 'pageindex': pageindex}    response = requests.get(url, data)    print(district_id)    # messages = {}    try:        print('response.text',response.text)        messages = json.loads(response.text)        total = messages[-2]['total']        if total >= page:            get_detail(city, district_id, pageindex + 1)        for message in messages[:-2]:            message['district'] = city[1]        li += messages[:-2]    except:        passdef spider():    regions_id = get_regions_id()    for region_id in regions_id:        citys_id = get_citys_id(region_id)        for city_id in citys_id:            districts_id = get_district(city_id[0])  # 区id            for district_id in districts_id:                get_detail(city_id[1], district_id, 1)    with open('../data/fuanna.json', 'w') as f:        f.write(json.dumps(li))def main():    # get_regions_id()    spider()if __name__ == '__main__':    main()
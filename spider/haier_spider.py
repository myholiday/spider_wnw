#!/usr/bin/env python# -*- coding: utf-8 -*-# Created by spider3 on 2018/3/13# Copyright (c) 2018 spider3. All rights reserved.import requestsimport jsonfrom utils.get_region_id import get_region_idfrom utils.get_baidu_coord import BaiduCoordfrom utils.save2mysql import save2mysql"""获取地址为 ： http://www.haier.com/cn/consumer/haier_store/zmd/index.shtml"""def get_province():    """获取省信息"""    url = "http://www.haier.com/HaierFramework/servicesupport/queryProvices.do"    response = requests.get(url)    data = json.loads(response.text)    print(response.text)    provinceInfo = data["provinceInfo"]    return provinceInfodef get_city(province):    """获取市信息"""    url = "http://www.haier.com/HaierFramework/servicesupport/queryCitys.do"    data = {"province": province}    response = requests.get(url, data)    data = json.loads(response.text)    cityInfo = data["cityInfo"]    print(response.text)    return cityInfodef get_store(province, city):    """获取商店详情"""    url = "http://www.haier.com/HaierFramework/cnStoreShopService/getPageStoreShopList.do"    data = {        'province': province,        'city': city,        'ordercondition': 2,        'pageIndex': 1,        'pageSize': 10000,    }    response = requests.post(url, data)    data = json.loads(response.text)    # print(response.text)    results = data["page"]["results"]    totalCount = data["page"]["totalCount"]    if len(results) != int(totalCount):        print("=====================", province, city)    return resultsdef save_data(data):    with open("../data/haier.json", "w") as f:        f.write(json.dumps(data))def spider():    # 爬取段 ：    data = []    provinces = get_province()    for province in provinces:  # 获取省，        citys = get_city(province)  # 获取市，        for city in citys:            print(province, city)            result = get_store(province, city)            data += result    save_data(data)def save_data():    with open("../data/haier.json", "r") as f:        data = f.read()        results = json.loads(data)[20000:30000]        print(len(results))        num = 93096  # id编号    for result in results:        result["id"] = num        result["name"] = result["shopName"]        result["preview_image"] = "brands_images/full/1439.jpg"        result["address"] = result["shopAddress"]        result["phone_number"] = result["shopPhone"] if result["shopPhone"] else "0"        # 经纬度        result["longitude"] = 0        result["latitude"] = 0        try:            bc = BaiduCoord(result["shopAddress"])            bc.get_ten_coord()            jw_coord = bc.get_jw_coord()            result["longitude"] = jw_coord["x"]            result["latitude"] = jw_coord["y"]        except:            pass        result["brand_id"] = 1439        # region_id        regionid1, regionid2, regionid3 = get_region_id(result["region"])        result["region_id_1"] = regionid1        result["region_id_2"] = regionid2        result["region_id_3"] = regionid3        result["data_source"] = 1        result["create_time"] = "NOW()"        print(num, result)        num += 1    with open("../data/haier_new93096-103095.json", "w") as f:        f.write(json.dumps(results))    save2mysql("localhost", "root", "root", "my_test", "feigo_shops", results)def main():    # 爬取时候开启    # spider()    # 修改数据段    save_data()if __name__ == '__main__':    main()
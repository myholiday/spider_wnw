#!/usr/bin/env python# -*- coding: utf-8 -*-# Created by spider3 on 2018/3/16# Copyright (c) 2018 spider3. All rights reserved."""欧神诺瓷砖"""import time"""http://about.oceano.com.cn/map/dizhi.html#"""import requestsimport jsonfrom utils.get_baidu_coord import BaiduCoordfrom utils.get_address_by_ten_coord import get_address_by_ten_coordfrom utils.get_region_id import get_region_iddef get_province():    url = 'http://about.oceano.com.cn/map/frontAjaxProvince.action'    response = requests.get(url)    province_details = json.loads(response.text)    return province_detailsdef get_city(province_detail):    data = {'id': province_detail['id']}    url = 'http://about.oceano.com.cn/map/frontAjaxCity.action'    response = requests.get(url, params=data)    city_details = json.loads(response.text)    # print(city_details)    return city_detailsdef get_info(city_detail):    data = {"id": city_detail['id']}    url = 'http://about.oceano.com.cn/map/frontAjaxBranch.action'    response = requests.get(url, params=data)    detail = json.loads(response.text)  # [{}{}{}]    return detaildef spider():    data_list = []    province_details = get_province()    for province_detail in province_details:        city_details = get_city(province_detail)        for city_detail in city_details:            try:                detail = get_info(city_detail)                print(detail)                data_list += detail                time.sleep(0.5)            except Exception as e:                detail = get_info(city_detail)                print(detail)                data_list += detail                time.sleep(5)    with open('../data/oceano.json', 'w') as f:        f.write(json.dumps(data_list))# 增加detail并保存def save():    with open('../data/oceano.json', 'r') as f:        data = json.loads(f.read())    i = 110937    for one_data in data:        one_data['id'] = i        i += 1        one_data['preview_image'] = 'brands_images/full/1381.jpg'        one_data['brand_id'] = 1381        one_data['create_time'] = 'NOW()'        # 获取经纬度        try:            bc = BaiduCoord(one_data['address'])            ten_coord = bc.get_ten_coord()            jw_coord = bc.get_jw_coord()            one_data['longitude'] = jw_coord['x']            one_data['latitude'] = jw_coord['y']            qu = get_address_by_ten_coord(ten_coord['x'], ten_coord['y'])            qu = qu['address_detail']['district']            regionid1, regionid2, regionid3 = get_region_id(qu)            one_data['region_id_1'] = regionid1            one_data['region_id_2'] = regionid2            one_data['region_id_3'] = regionid3        except:            one_data['longitude'] = 0            one_data['latitude'] = 0            one_data['region_id_1'] = 0            one_data['region_id_2'] = 0            one_data['region_id_3'] = 0        print(one_data)    with open('../data/oceano_detail.json', 'w') as f:        f.write(json.dumps(data))def main():    # spider()    save()if __name__ == '__main__':    main()
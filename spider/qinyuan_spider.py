#!/usr/bin/env python# -*- coding: utf-8 -*-# Created by spider3 on 2018/3/27# Copyright (c) 2018 spider3. All rights reserved."""沁园""""""http://www.qinyuanmall.com/experienceSearch/list.jhtml?local=%E4%BD%9B%E5%B1%B1%E5%B8%82"""import requestsimport jsonimport refrom lxml import etreefrom utils.add_detail import add_detaildef get_province():    url = 'http://www.qinyuanmall.com/experienceSearch/list.jhtml?province=%E6%B2%B3%E5%8C%97%E7%9C%81'    response = requests.get(url)    html = etree.HTML(response.text)    province = html.xpath('//ul[@id="main_nav"]/li[1]/dl/dd/a/text()')    print(province)    return provincedef get_data(province):    li = []    url = 'http://www.qinyuanmall.com/experienceSearch/list.jhtml'    data = {'province': province}    response = requests.get(url, data)    names = re.findall(r'<div class=\\"fjhw\\">(.*?)</div>"', response.text)    phones = re.findall(r'<span class=\\"fjd\\">(.*?)</span>', response.text)    addresses = re.findall(r'getPoint\("(.*?)",', response.text)    if len(names) == len(phones) and len(names) == len(addresses):        print(len(names))        for i in range(len(names)):            tmp = {}            tmp['name'] = names[i]            tmp['phone_number'] = phones[i]            tmp['address'] = addresses[i]            li.append(tmp)            print(tmp)    return lidef spider():    li = []    provinces = get_province()    for province in provinces:        li += get_data(province)    try:        with open('../data/qinyuan.json', 'w') as f:            f.write(json.dumps(li, ensure_ascii=False))    except:        with open('../data/qinyuan.json', 'w') as f:            f.write(json.dumps(li))def main():    spider()if __name__ == '__main__':    main()
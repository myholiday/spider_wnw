#!/usr/bin/env python# -*- coding: utf-8 -*-# Created by spider3 on 2018/3/20# Copyright (c) 2018 spider3. All rights reserved."""瑞宝壁纸"""import json"""http://rb.com.cn/"""import requestsfrom lxml import etreedef get_provinces_url():    url = 'http://www.rb.com.cn/map/%E5%8C%97%E4%BA%AC-1'    response = requests.get(url)    html = etree.HTML(response.text)    nodes = html.xpath('//div[@id="c_companyplace_category-15063876845017183"]/div/div/div[1]/div/a/@href')    provinces_url = ['http://www.rb.com.cn' + node for node in nodes]    print(provinces_url)    return provinces_urldef get_total_page(url):    response = requests.get(url)    html = etree.HTML(response.text)    nodes = html.xpath('//div[@class="e_pagebox e_pagebox-000 p_page"]/div')    total_page = nodes[-2].xpath('./text()')[0]    print(total_page)    return int(total_page)def get_detail(url):    li = []    response = requests.get(url)    html = etree.HTML(response.text)    nodes = html.xpath('//div[@class="e_box e_box-000 p_InfoBox"]')    for node in nodes:        tmp = {}        tmp['name'] = node.xpath('./div[1]/h3/div/text()')[-1].strip('\t').strip('\n').strip('★')        tmp['address'] = node.xpath('./div[2]/article/text()')[0].strip('\t').strip('\n')        tmp['phone_number'] = node.xpath('./div[3]/div/div[2]/div/text()')[-1].strip('\t').strip('\n')        print(tmp)        li.append(tmp)    return lidef spider():    li = []    provinces_url = get_provinces_url()    for province_url in provinces_url:        try:            total_page = get_total_page(province_url)        except:            total_page = 0        for page in range(1, 1 + total_page):            url = province_url + "#c_companyplace_list-15063882405076342-{}".format(page)            mess = get_detail(url)            li += mess    with open('../data/rb.json', 'w') as f:        f.write(json.dumps(li))def main():    # get_provinces_url()    # get_total_page('http://www.rb.com.cn/map/吉林-5')    # get_detail('http://www.rb.com.cn/map/%E5%8C%97%E4%BA%AC-1')    spider()if __name__ == '__main__':    main()
#!/usr/bin/env python# -*- coding: utf-8 -*-# Created by spider3 on 2018/3/20# Copyright (c) 2018 spider3. All rights reserved."""科翔布纸""""""http://www.kxbz.cn/store.html"""import requestsimport reimport jsonfrom lxml import etreefrom utils.add_detail import add_detail# 获得区编号def get_province_ids():    url = 'http://www.kxbz.cn/controller/contro1.php?action=stropros&r=8468'    response = requests.get(url)    province_ids = re.findall(r'value=(\d*?)>', response.text)    print(province_ids)    return province_idsdef get_city_ids(province_id):    url = 'http://www.kxbz.cn/controller/contro1.php'    data = {'provce': province_id, 'action': 'citypro1'}    response = requests.get(url, data)    city_ids = re.findall(r'value=(\d*?)>', response.text)    print(city_ids)# 根据省id获取json数据def get_detail(province_id):    url1 = 'http://www.kxbz.cn/controller/contro1.php'    data1 = {'action': 'stejson', 'provce': province_id, 'town': 'undefined'}    response1 = requests.get(url1, data1)    response1 = json.loads(response1.text.replace(r'	', ''))    if not response1:  # 如果没有数据，直接返回        return []    url2 = 'http://www.kxbz.cn/controller/contro1.php?action=getstore'    data2 = {'action': 'getstore', 'provce': province_id, 'town': 'undefined'}    response2 = requests.get(url2, data2)    html2 = etree.HTML(response2.text)    nodes = html2.xpath('//li[@id="store_id_2"]')    for i in range(len(nodes)):        tmp = response1[i]        tmp["address2"] = nodes[i].xpath('./a/div[2]/p[1]/text()')[0]        tmp["phone_number"] = nodes[i].xpath('./a/div[2]/p[2]/text()')[0].split('：')[-1]        tmp['longitude'] = tmp['jindu']        tmp['latitude'] = tmp['weidu']        print(province_id, i)        print(tmp)    return response1def spider():    li = []    province_ids = get_province_ids()    for province_id in province_ids:        li += get_detail(province_id)    for one_data in li:        one_data['name'] = one_data['title']    with open("../data/kxbz.json", 'w') as f:        f.write(json.dumps(li, ensure_ascii=False))def save():    add_detail(129581, 204, '../data/kxbz.json', '../data/kxbz_detail.json')def main():    # spider()    save()if __name__ == '__main__':    main()
#!/usr/bin/env python# -*- coding: utf-8 -*-# Created by spider3 on 2018/3/6# Copyright (c) 2018 spider3. All rights reserved.import pymysqlimport requestsdef get_region_id(qu):    """    输入区,如朝阳区,查询mysql表格，获得省、市、区编号    如果出错就返回三个 0    :param qu: 如 朝阳区    :return:    """    connection = pymysql.connect(host='localhost',                                 user='root',                                 password='root',                                 db='qianxungou',                                 port=3306,                                 charset='utf8')    regionid1, regionid2, regionid3 = 0, 0, 0    try:        with connection.cursor() as cursor:            sql = "select * from feigo_regions where `name`='{}'".format(qu)            cursor.execute(sql)            data = cursor.fetchall()            regionid3 = data[0][0]            regionid2 = data[0][2]            sql = "select * from feigo_regions where `id`=" + str(regionid2)            cursor.execute(sql)            data = cursor.fetchall()            regionid1 = data[0][2]    except Exception as e:        print(e)    finally:        return regionid1, regionid2, regionid3def get_region_id_by_adcode(adcode, address="", jw_coord=""):  # todo 如果 address 如果搜不到就用地址搜    """    根据region_id获取前面的region_id,如果是东莞的话会先匹配address中的地址，如果没有，就用地址搜索定位位置，看位置中有没有    :param adcode: 130100  130902  410402 三个都是叫 新华区    :return:    """    if int(adcode) == 441900:  # 如果是东莞的话        dongguan_short_name = ['莞城', '补一个什么都不是', '南城', '万江', '石碣', '石龙', '茶山', '石排', '企石', '横沥', '桥头', '谢岗', '东坑', '常平', '寮步', '大朗', '麻涌', '中堂', '高埗', '樟木头', '大岭山', '望牛墩', '黄江', '洪梅', '清溪', '沙田', '道滘', '塘厦', '虎门', '厚街', '凤岗', '长安']        regionid1, regionid2, regionid3 = 440000, 441900, 0        # 遍历地址中        for index, short_name in enumerate(dongguan_short_name):            if short_name in address:                regionid3 = 441901 + index                return regionid1, regionid2, regionid3        # 如果address不包含地址信息，则用经纬度搜索定位，定位中会有区信息        response = requests.get("http://restapi.amap.com/v3/geocode/regeo?key=5f2e9ed810bca7a99abc98f3808afce5&poitype=&radius=&extensions=all&batch=true&roadlevel=0&location={}".format(jw_coord))        response = response.text        for index, short_name in enumerate(dongguan_short_name):            if short_name in response:                regionid3 = 441901 + index                return regionid1, regionid2, regionid3        return regionid1, regionid2, regionid3    connection = pymysql.connect(host='localhost',                                 user='root',                                 password='root',                                 db='qianxungou',                                 port=3306,                                 charset='utf8')    regionid1, regionid2, regionid3 = 0, 0, adcode  # 查不到默认regionid3是传进来的id    try:        with connection.cursor() as cursor:            sql = "select * from feigo_regions where `id`='{}'".format(adcode)            cursor.execute(sql)            data = cursor.fetchall()            regionid3 = data[0][0]            regionid2 = data[0][2]            sql = "select * from feigo_regions where `id`=" + str(regionid2)            cursor.execute(sql)            data = cursor.fetchall()            regionid1 = data[0][2]    except Exception as e:        print(e)    finally:        return regionid1, regionid2, regionid3def main():    print(get_region_id('朝阳区'))    print(get_region_id_by_adcode(441900, "茶南路与金山路交叉口南50米", '113.898651,23.070074'))if __name__ == '__main__':    main()